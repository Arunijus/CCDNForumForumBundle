<div class="section_tool_strip" id="post_{{ post.getId }}" {% if key is defined %}{% if key != 0 %} style="border-top: 1px solid #ddd;"{% endif %}{% endif %}>
	<div class="float_left">
		<a class="button_link_silver" href="{{ path('cc_forum_post_show', {'post_id': post.getId }) }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_permalink.png') }}" alt="permalink">#{{ post.getId }}</a>
		<a class="button_link_silver" href="#post_{{ post.getId }}">#{{ post.getId }}</a>
	</div>
	<div class="float_right">
		{% if is_granted('ROLE_USER') %}
			{% if post.getCreatedBy %}
			<a class="button_silver" href="{{ path('cc_message_message_compose_to', {'user_id': post.getCreatedBy.getId }) }}" data-tipsy="north" title="{{ 'link.user.message' | trans({}, 'CCDNUserProfileBundle') }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_email.png') }}" alt="{{ 'link.user.message' | trans({}, 'CCDNUserProfileBundle') }}"></a>
			{% endif %}
			
			<a class="button_silver" href="{{ path('cc_forum_topic_reply', {'topic_id': post.getTopic.getId }) }}" data-tipsy="north" title="{{ 'link.post.reply' | trans({}, 'CCDNForumForumBundle') }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_comment.png') }}" alt="{{ 'link.post.reply' | trans({}, 'CCDNForumForumBundle') }}"></a>
			<a class="button_silver" href="{{ path('cc_forum_topic_reply_with_quote', {'topic_id': post.getTopic.getId, 'quote_id': post.getId }) }}" data-tipsy="north" title="{{ 'link.post.quote' | trans({}, 'CCDNForumForumBundle') }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_quote.png') }}" alt="{{ 'link.post.quote' | trans({}, 'CCDNForumForumBundle') }}"></a>	

			{% if post.getCreatedBy %}	
				{% if post.getCreatedBy.getId != user.getId %}
				<a class="button_silver" href="{{ path('cc_forum_karma_rate', {'post_id': post.getId }) }}" data-tipsy="north" title="{{ 'link.post.rate' | trans({}, 'CCDNForumKarmaBundle') }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_karma.png') }}" alt="{{ 'link.post.rate' | trans({}, 'CCDNForumKarmaBundle') }}"></a>
				{% endif %}

				{% if post.getCreatedBy.getId == user.getId and not is_granted('ROLE_MODERATOR') %}
				<a class="button_silver" href="{{ path('cc_forum_post_edit', {'post_id': post.getId }) }}" data-tipsy="north" title="{{ 'link.post.edit' | trans({}, 'CCDNForumForumBundle') }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_edit.png') }}" alt="{{ 'link.post.edit' | trans({}, 'CCDNForumForumBundle') }}"></a>
					{% if not post.getDeletedBy %}
					<a class="button_red" href="{{ path('cc_forum_post_delete', {'post_id': post.getId }) }}" data-tipsy="north" title="{{ 'link.post.delete' | trans({}, 'CCDNForumForumBundle') }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_trash.png') }}" alt="{{ 'link.post.delete' | trans({}, 'CCDNForumForumBundle') }}"></a>
					{% endif %}
				{% endif %}
			{% endif %}
		
			{% if is_granted('ROLE_MODERATOR') %}
			<a class="button_silver" href="{{ path('cc_forum_post_edit', {'post_id': post.getId }) }}" data-tipsy="north" title="{{ 'link.post.edit' | trans({}, 'CCDNForumForumBundle') }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_edit.png') }}" alt="{{ 'link.post.edit' | trans({}, 'CCDNForumForumBundle') }}"></a>
			
				{% if post.getDeletedBy %}
				<a class="button_red" href="{{ path('cc_moderator_forum_post_restore', {'post_id': post.getId }) }}" data-tipsy="north" title="{{ 'link.post.restore' | trans({}, 'CCDNForumForumBundle') }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_link.png') }}" alt="{{ 'link.post.restore' | trans({}, 'CCDNForumForumBundle') }}"></a>
				{% else %}
				<a class="button_red" href="{{ path('cc_forum_post_delete', {'post_id': post.getId }) }}" data-tipsy="north" title="{{ 'link.post.delete' | trans({}, 'CCDNForumForumBundle') }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_trash.png') }}" alt="{{ 'link.post.delete' | trans({}, 'CCDNForumForumBundle') }}"></a>				
				{% endif %}
				
				{% if post.getLockedBy %}
				<a class="button_red" href="{{ path('cc_moderator_forum_post_unlock', {'post_id': post.getId }) }}" data-tipsy="north" title="{{ 'link.post.unlock' | trans({}, 'CCDNForumForumBundle') }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_unlocked.png') }}" alt="{{ 'link.post.unlock' | trans({}, 'CCDNForumForumBundle') }}"></a>
				{% else %}
				<a class="button_red" href="{{ path('cc_moderator_forum_post_lock', {'post_id': post.getId }) }}" data-tipsy="north" title="{{ 'link.post.lock' | trans({}, 'CCDNForumForumBundle') }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_locked.png') }}" alt="{{ 'link.post.lock' | trans({}, 'CCDNForumForumBundle') }}"></a>
				{% endif %}
			{% endif %}
			
			{% if post.getCreatedBy %}	
				{% if post.getCreatedBy.getId != user.getId %}				
				<a class="button_red" href="{{ path('cc_forum_post_flag', {'post_id': post.getId }) }}" data-tipsy="north" title="{{ 'link.post.flag' | trans({}, 'CCDNForumForumBundle') }}"><img class="button_16x16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_flag.png') }}" alt="{{ 'link.post.flag' | trans({}, 'CCDNForumForumBundle') }}"></a>
				{% endif %}
			{% endif %}
		{% endif %}
		
	</div>
</div>



	<div style="display:block; float:left; width:105px; margin:0px -106px 0px 0px; padding:0px; overflow:hidden; vertical-align:top; text-align:center;">
		<div style="margin: 0px; padding: 5px 0; overflow: hidden; vertical-align: top; text-align: center; z-index: 3;">
			{% spaceless %}
			
			{% if post.getCreatedBy %}
				{% if post.getCreatedBy.getProfile %}
					{% if post.getCreatedBy.getProfile.getAvatarIsRemote %}
						{% if post.getCreatedBy.getProfile.getAvatar %}
							<img class="avatar" width="100" height="100" src="{{ post.getCreatedBy.getProfile.getAvatar }}" alt="avatar">
						{% else %}
							<img class="avatar" width="100" height="100" src="{{ asset('bundles/ccdncomponentcommon/images/profile/anonymous_avatar.gif') }}" alt="avatar">
						{% endif %}
					{% else %}
						{% if post.getCreatedBy.getProfile.getAvatar %}
							{# later on this will reference the avatarBundle asset and append the avatar onto the end #}
							{# e.g: {{ asset('bundles/ccdnuseravatar/images/avatars/') }}{{ post.getCreatedBy.getProfile.getAvatar }} #}
							<img class="avatar" width="100" height="100" src="{{ asset('bundles/ccdncomponentcommon/images/profile/anonymous_avatar.gif') }}" alt="avatar">
						{% else %}
							<img class="avatar" width="100" height="100" src="{{ asset('bundles/ccdncomponentcommon/images/profile/anonymous_avatar.gif') }}" alt="avatar">
						{% endif %}
					{% endif %}
				{% else %}
					<img class="avatar" width="100" height="100" src="{{ asset('bundles/ccdncomponentcommon/images/profile/anonymous_avatar.gif') }}" alt="avatar">
				{% endif %}
			{% else %}
				<img class="avatar" width="100" height="100" src="{{ asset('bundles/ccdncomponentcommon/images/profile/anonymous_avatar.gif') }}" alt="avatar">
			{% endif %}

{#			
			<div class="h_align_centre">
				<img class="icon16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_star.png') }}" alt="icon">
				<img class="icon16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_star.png') }}" alt="icon">
				<img class="icon16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_star.png') }}" alt="icon">
				<img class="icon16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_star.png') }}" alt="icon">
				<img class="icon16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_star.png') }}" alt="icon">
			</div>
#}

			{% if registries[post.getCreatedBy().getId()] is defined %}
			<div style="text-align: center; vertical-align: middle;">
				<div style="display: inline-block; margin: 0px; padding: 3px; height: 16px; line-height: 8px; vertical-align: middle;"><img class="icon16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_karma.png') }}" alt="icon"></div>
				<div style="display: inline-block; margin: 0px; padding: 3px; height: 16px; line-height: 8px; vertical-align: middle; color: #ff0000;"><span class="common_body">-{{ registries[post.getCreatedBy().getId()].getCacheKarmaNegativeCount }}&nbsp;</span></div>
				<div style="display: inline-block; margin: 0px; padding: 3px; height: 16px; line-height: 8px; vertical-align: middle; color: #15a115;"><span class="common_body">&nbsp;+{{ registries[post.getCreatedBy().getId()].getCacheKarmaPositiveCount }}</span></div>
			</div>
			
			<div style="text-align: center;">{{ 'post.user.post_count' | trans({'%post_count%': registries[post.getCreatedBy().getId()].getCachePostCount()}, 'CCDNForumForumBundle') }}</div>
			{% endif %}

			{% endspaceless %}		
		</div>
	</div>
	<div style="display: block; padding: 0px; overflow: hidden; vertical-align: top;">
		<div style="display: block; float: width: 100%: right; padding: 1px; margin: 0px 0px 0px 106px; overflow: hidden; vertical-align: top;">
			
			<div class="round_box" style="margin-left: 20px !important; {#margin-bottom: -30px;#} min-height: 60px !important;">
				{% spaceless %}
				<div style="display: block; z-index: 1; margin: 0 0 -30px;">
				<img class="text_bubble_chevron" width="20" height="30" src="{{ asset('bundles/ccdnforumforum/images/text_bubble/chevron_left.png') }}" alt="chevron">
				</div>

				<div style="display: block; z-index: 2;">
					{# position: relative;	top: -30px;	z-index: 2; visibility: visible; overflow: visible; border: 1px solid blue; #}
					<div class="float_left">
						<span class="username_medium">
							{% if post.getCreatedBy %}
							<a href="{{ path(user_profile_route, {'user_id': post.getCreatedBy.getId } ) }}">{{ post.getCreatedBy }}</a>
							{% else %}
							Guest
							{% endif %}
						</span>&nbsp;&nbsp;
						<span class="item_timestamp">
							{{ post.getCreatedDate|date("d-m-Y - H:i") }}
						</span>
					
						{% if post.getEditedDate %}
							&nbsp;&nbsp;
							<span class="item_timestamp">(
							{{ 'post.edited_by' |trans({}, 'CCDNForumForumBundle') }}
							{% if post.getEditedBy %}<a href="{{ path(user_profile_route, {'user_id': post.getEditedBy.getId}) }}">{{ post.getEditedBy.getUsername |title }}</a>{% else %}Guest{% endif %}
							{{ 'actioned.at' |trans({}, 'CCDNForumForumBundle') }}{{ post.getEditedDate |date("d-m-Y - H:i") }}
							)</span><br>
						{% endif %}
					</div>
					<div class="float_right">
						{% if post.getFlags.count > 0 %}
							<span class="common_body">
								<img class="icon16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_flag.png') }}" alt="icon">
								{{ 'post.has_been_flagged' |trans({}, 'CCDNForumForumBundle') }}
							</span>
						{% endif %}
						{% if post.getLockedDate %}
							<img class="icon16" width="16" height="16" src="{{ asset('bundles/ccdncomponentcommon/images/icons/Black/16x16/16x16_locked.png') }}">
						{% endif %}						
					</div>
					<br><hr>
					{% if post.getDeletedBy %}
						<span class="deleted_on">
						{{ 'post.is_deleted' | trans({}, 'CCDNForumForumBundle') }} - 
						{{ 'post.deleted_by' |trans({}, 'CCDNForumForumBundle') }}
						{% if post.getDeletedBy %}{{ post.getDeletedBy.getUsername |title }}{% else %}Guest{% endif %}
						{{ 'actioned.at' |trans({}, 'CCDNForumForumBundle') }}{{ post.getCreatedDate|date("d/m/Y - H:i:s") }}
						</span>
					{% else %}
						<span class="common_body">
							<br>{{ BBCode(post.getBody | raw) | raw}}<br>
						</span>
						<span class="common_body">
							{% if post.getAttachment %}
								<br><a href="{{ path('cc_attachment_download', {'attachment_id': post.getAttachment.getId }) }}"><img width="60" height="60" src="{{ path('cc_attachment_thumbnail', {'attachment_id': post.getAttachment.getId }) }}" alt="{{ post.getAttachment.getAttachmentOriginal }}"></a><br>
							{% endif %}
						</span>
						<br><hr>
						<span class="common_body">
							{% if post.getCreatedBy %}
								{% if post.getCreatedBy.getProfile %}
									{% if post.getCreatedBy.getProfile.getSignature %}
										{{ BBCode(post.getCreatedBy.getProfile.getSignature | raw) | raw }}
									{% endif %}
								{% endif %}
							{% endif %}
						</span>
					{% endif %}
				</div>	
				{% endspaceless %}
				
			</div>
			
		</div>
	</div>
<br>
